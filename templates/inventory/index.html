{% extends 'backstage/base.html' %}
{% load static %}
{% block title %}
{{ PROJECT_NAME }}
{% endblock %}

{% block customized_css %}
{% endblock %}

{% block main %}

<div class="container">
    <div class="row">
        hello, world!
    </div>
    <div class="row">
        <select name="year" id="year" onchange="call()"></select>年
        <select name="month" id="month" onchange="call()"></select>月
        <select name="day" id="day" onchange="call()"></select>日
    </div>
    <div class="row">
        <canvas id="record"></canvas>
    </div>
</div>
{% endblock %}

{% block customized_js %}
<script>

let indexInit = () => {
    let list = [['year', 2010, 2019], ['month', 1, 12], ['day', 1, 31]]
    for(let i=0; i<list.length; i++){
        let parent = document.getElementById(list[i][0]);
        let child = document.createElement('option');
        child.text = '---';
        parent.add(child);
        for(let j=list[i][1]; j<=list[i][2]; j++){
            let child = document.createElement('option');
            child.text = j;
            parent.add(child);
        }
    }
    drawChart(0,0,0);
}

let call = () => {
    let year = document.getElementById('year').value;
    let month = document.getElementById('month').value;
    let day = document.getElementById('day').value;
    if(year == '---') year = 0;
    if(month == '---') month = 0;
    if(day == '---') day = 0;
    drawChart(year, month, day);
}

let drawChart = (year, month, day) => {
    fetch(`/inventory/get_statistic_data/${year}/${month}/${day}`)
    .then(res => res.json())
    .then(res => {
        let aspect = 2;
        if(window.bar !== undefined)
            window.bar.destroy();
        if(window.mobilecheck())
            aspect = 1;
        var ctx = document.getElementById('record').getContext('2d');
        window.bar = new Chart(ctx, {
            type: 'horizontalBar',
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            
            data: {
                labels: res['label'],
                datasets: [
                    {
                        label: "出貨",
                        backgroundColor: "rgba(255, 99, 132, 0.2)",
                        borderColor: 'rgba(255,99,132,1)',
                        data: res['SendRecord'],
                        borderWidth: 1,
                    },
                    {
                        label: "進貨",
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        data: res['ReceiveRecord'],
                        borderWidth: 1,
                    },
                    {
                        label: "庫存",
                        backgroundColor: 'rgba(255, 206, 86, 0.2)',
                        borderColor: 'rgba(255, 206, 86, 1)',
                        data: res['Resource'],
                        borderWidth: 1,
                    },
                ]
            },
            options: {
                aspectRatio: aspect,
                barValueSpacing: 20,
                scales: {xAxes: [{ ticks: { min: 0 }}]}
            }
        });
    });
}

indexInit();

</script>
{% endblock %}